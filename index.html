<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ æ†è®¡ç®—å™¨</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: Inter, sans-serif;

      /* Flex å±…ä¸­å¡ç‰‡ */
      display: flex;
      align-items: center;
      justify-content: center;
      background: #0f1724;
    }

    canvas#bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    .card {
      position: relative;
      z-index: 1;
      width: 720px;
      max-width: 95vw;
      background: linear-gradient(180deg,#071426,#071c2b);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 12px 30px rgba(2,6,23,0.7);
      color: #e6eef8;
      margin: 0;
    }

    h1 { margin: 0 0 8px 0; font-size: 20px }
    p.sub { margin: 0 0 18px 0; color: #94a3b8; font-size: 13px }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px }
    label { display: block; font-size: 13px; color: #9fb4dd; margin-bottom: 6px }
    input { width: 80%; margin: 0 auto; padding: 10px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.04); background: rgba(255,255,255,0.02); color: #e6eef8; font-size: 15px }
    .row { display: flex; gap: 8px }
    button { padding: 10px 14px; border-radius: 8px; border: 0; cursor: pointer; background: #0b3b63; color: white; font-weight: 600 }
    .result { background: rgba(255,255,255,0.02); padding: 12px; border-radius: 8px; margin-top: 10px; color: #dbeafe }
    .muted { color: #94a3b8; font-size: 13px }
    .formula { background: rgba(255,255,255,0.015); padding: 10px; border-radius: 8px; margin-top: 12px; color: #cfe3ff; font-size: 14px }
    .example { font-size: 13px; color: #cddffb }
    footer { margin-top: 12px; color: #94a3b8; font-size: 12px }
    @media (max-width: 640px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- æ˜Ÿç©ºèƒŒæ™¯ canvas -->
  <canvas id="bg"></canvas>

  <!-- è®¡ç®—å™¨å¡ç‰‡ -->
  <div class="card">
    <h1>æ æ† â€” ç›ˆåˆ©å…³ç³»è®¡ç®—å™¨</h1>
    <p class="sub">è¾“å…¥æ æ†ã€ç›®æ ‡æ”¶ç›Šæˆ–æ ‡çš„å˜åŠ¨ï¼Œè‡ªåŠ¨æ‰£é™¤æ‰‹ç»­è´¹ï¼ˆé»˜è®¤0.07%ï¼‰ã€‚</p>

    <div class="grid">
      <div>
        <label>æ æ†å€æ•° (Ã—)</label>
        <input id="leverage" type="number" min="1" step="0.01" value="25">
      </div>
      <div>
        <label>æ‰‹ç»­è´¹ç‡ (%)</label>
        <input id="feePct" type="number" step="0.0001" value="0.07">
      </div>
      <div>
        <label>ç›®æ ‡æ”¶ç›Šï¼ˆ%ï¼‰</label>
        <input id="targetProfit" type="number" step="0.0001" value="10">
      </div>
      <div>
        <label>æ ‡çš„å®é™…å˜åŠ¨ï¼ˆ%ï¼‰</label>
        <input id="underlyingMove" type="number" step="0.0001" placeholder="ä¾‹å¦‚ 0.4">
      </div>
    </div>

    <div class="row" style="margin-bottom:8px">
      <button id="calcRequired">ä» æ æ†+ç›®æ ‡æ”¶ç›Š â†’ è®¡ç®—æ ‡çš„éœ€å˜åŠ¨</button>
      <button id="calcProfit">ä» æ æ†+æ ‡çš„å˜åŠ¨ â†’ è®¡ç®—æ”¶ç›Š</button>
      <button id="clearAll" style="background:#1f2937">æ¸…é™¤</button>
    </div>

    <div id="out" class="result" aria-live="polite">
      <div id="outText">ç»“æœä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
      <div class="formula" id="formulaArea">
        <strong>å…¬å¼</strong>
        <div>æ¯›æ”¶ç›Šç‡ (%) = æ æ† Ã— æ ‡çš„å˜åŠ¨ (%)</div>
        <div>å‡€æ”¶ç›Šç‡ (%) = æ¯›æ”¶ç›Šç‡ âˆ’ (æ‰‹ç»­è´¹ç‡ Ã— æ æ†)</div>
        <div>æ ‡çš„éœ€å˜åŠ¨ (%) = (ç›®æ ‡æ”¶ç›Šç‡ + æ‰‹ç»­è´¹ç‡ Ã— æ æ†) Ã· æ æ†</div>
      </div>
    </div>

    <div class="example">
      <strong>ç¤ºä¾‹ï¼š</strong> æ æ† 25Ã—ï¼Œç›®æ ‡æ”¶ç›Š 10%ï¼Œæ‰‹ç»­è´¹ç‡ 0.07% â†’ æ ‡çš„éœ€ä¸Šæ¶¨ â‰ˆ (10+0.07Ã—25)/25 = 0.47%ã€‚
    </div>

    <footer>æ³¨æ„ï¼šè¿™é‡Œåªè®¡ç®—å•è¾¹æ‰‹ç»­è´¹ï¼Œå¦‚æœå®é™…äº¤æ˜“æ˜¯åŒè¾¹ï¼ˆå¼€ä»“+å¹³ä»“ï¼‰ï¼Œè®°å¾—æŠŠæ‰‹ç»­è´¹ç‡ç¿»å€ã€‚</footer>
  </div>

  <script>
    // ====== æ æ†è®¡ç®—å™¨ JS ======
    function fmtPercent(n){
      if (!isFinite(n)) return 'â€”';
      const fixed = Number(n).toFixed(6);
      return parseFloat(fixed).toString().replace(/\.0+$/,'') + '%';
    }
    function getVal(id){
      const v = parseFloat(document.getElementById(id).value);
      return isNaN(v) ? NaN : v;
    }
    const outText = document.getElementById('outText');

    document.getElementById('calcRequired').addEventListener('click', () => {
      const L = getVal('leverage'), target = getVal('targetProfit'), fee = getVal('feePct');
      if(!isFinite(L)||L<=0||!isFinite(target)){outText.innerText='è¯·å¡«å†™æ æ†ä¸ç›®æ ‡æ”¶ç›Šã€‚';return;}
      const move=(target+fee*L)/L;
      const finalNet = target - fee*L; // ç›®æ ‡å‡€æ”¶ç›Š - æ‰‹ç»­è´¹
      outText.innerHTML=`<strong>ç»“æœï¼š</strong><br>
        æ æ† ${L}Ã—, ç›®æ ‡å‡€æ”¶ç›Š ${target}%<br>
        æ ‡çš„éœ€å˜åŠ¨ â‰ˆ <strong>${fmtPercent(move)}</strong><br>
        (å«æ‰‹ç»­è´¹ ${fee}% Ã— æ æ† â†’ ${fmtPercent(fee*L)})<br>
        ğŸ‘‰ æœ€ç»ˆç›®æ ‡å‡€æ”¶ç›Š â‰ˆ <strong style="color:#22c55e">${fmtPercent(finalNet)}</strong>`;
      document.getElementById('underlyingMove').value = Number(move.toFixed(6));
    });

document.getElementById('calcProfit').addEventListener('click', () => {
  const L = getVal('leverage'), move = getVal('underlyingMove'), fee = getVal('feePct');
  if (!isFinite(L) || L <= 0 || !isFinite(move)) {
    outText.innerText = 'è¯·å¡«å†™æ æ†ä¸æ ‡çš„å˜åŠ¨ã€‚'; 
    return;
  }

  // ä¸è®¡æ‰‹ç»­è´¹ï¼ˆä¸»ç»“æœï¼‰
  const gross = L * move;          // æ¯›æ”¶ç›Š = æ æ† Ã— æ ‡çš„å˜åŠ¨

  // è®¡æ‰‹ç»­è´¹ï¼ˆå¯¹æ¯”é¡¹ï¼‰
  const net = gross - fee * L;     // å‡€æ”¶ç›Š = æ¯›æ”¶ç›Š âˆ’ (æ‰‹ç»­è´¹ç‡ Ã— æ æ†)

  outText.innerHTML = `<strong>ç»“æœï¼š</strong><br>
    æ æ† ${L}Ã—, æ ‡çš„å˜åŠ¨ ${fmtPercent(move)}<br>
    â”œâ”€ <span style="color:#a5f3fc">ä¸è®¡æ‰‹ç»­è´¹ï¼ˆæ¯›æ”¶ç›Šï¼‰â‰ˆ ${fmtPercent(gross)}</span><br>
    â””â”€ <span style="color:#fca5a5">è®¡æ‰‹ç»­è´¹ï¼ˆå‡€æ”¶ç›Šï¼‰â‰ˆ ${fmtPercent(net)}</span><br>
    (æ‰‹ç»­è´¹ ${fee}% Ã— æ æ† â†’ ${fmtPercent(fee * L)})`;

  // ä¸å†å†™å…¥ targetProfitï¼Œé¿å…â€œçœ‹èµ·æ¥åƒåŠ ä¸Šäº†æ‰‹ç»­è´¹â€
  // å¦‚éœ€è‡ªåŠ¨å¡«å…¥ï¼Œå¯æ”¹ä¸ºï¼šdocument.getElementById('targetProfit').value = Number(gross.toFixed(6)); // æ¯›æ”¶ç›Š
  // æˆ–ï¼šdocument.getElementById('targetProfit').value = Number(net.toFixed(6));   // å‡€æ”¶ç›Š
});


    document.getElementById('clearAll').addEventListener('click',()=>{
      ['leverage','targetProfit','underlyingMove','feePct'].forEach(id=>document.getElementById(id).value='');
      outText.innerText='å·²æ¸…é™¤ã€‚';
    });

    // ====== æ˜Ÿç©ºèƒŒæ™¯ JS ======
    const canvas = document.getElementById("bg");
    const ctx = canvas.getContext("2d");
    let stars = [];
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      stars = Array.from({length:150}, () => ({
        x: Math.random()*canvas.width,
        y: Math.random()*canvas.height,
        r: Math.random()*1.5,
        d: Math.random()*1
      }));
    }
    function drawStars() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle="#fff";
      stars.forEach(s=>{
        ctx.beginPath();
        ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
        ctx.fill();
      });
      updateStars();
    }
    function updateStars(){
      stars.forEach(s=>{
        s.y += s.d;
        if(s.y>canvas.height){
          s.y=0;
          s.x=Math.random()*canvas.width;
        }
      });
    }
    function animate(){
      drawStars();
      requestAnimationFrame(animate);
    }
    window.addEventListener("resize", resize);
    resize();
    animate();
  </script>
</body>
</html>
